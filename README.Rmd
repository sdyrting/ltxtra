---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ltxtra

<!-- badges: start -->
[![R-CMD-check](https://github.com/sdyrting/ltxtra/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/sdyrting/ltxtra/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

An R package for calculating non-standard life table variables

## Installation

You can install the development version of ltxtra from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("sdyrting/ltxtra")
```

<!--
To install ltxtra from its tarball, change working directory to directory of the tarball and enter the following in the R console.

``` r
# install.packages('devtools') ## Install devtools if you don't have it
devtools::install_local('./ltxtra-0.0.0.9000.tar.gz')
```
-->

## Example 1: Adding life disparity to a life table

This is a basic example which shows you how to add a life disparity column to a life table:

```{r example1}
library(ltxtra)
library(dplyr)
library(ggplot2)

head(aus_2021_2023 %>% select(!c(mx,ax)))

daus_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()

head(daus_lt %>% select(!c(mx,ax)))

daus_lt %>% ggplot() +
  geom_line(aes(x=Age,y=vx,group=State,colour=State)) +
  labs(y='Life Disparity (Years)')+
  facet_wrap(vars(Sex))
```
## Example 2

`ltxtra` assumes life tables are in same form as those produced by the `HMDHFDplus` package. This makes it easy to import and decorate life tables from the Human Mortality Database and associated subnational databases.

```{r example2,fig.cap='Japanese Adult Life Expectancy and Disparity by Year and Sex'}
library(tidyverse)
library(HMDHFDplus)
library(ltxtra)
library(ggplot2)

prefID <- '00' #All Japan

jpn_lt <- readJMDweb(prefID,"fltper_1x1") %>% 
  mutate(Sex = 'Female') %>%
  bind_rows(readJMDweb(prefID,"mltper_1x1") %>% 
  mutate(Sex = 'Male')) %>%
  group_by(Year,Sex) %>% lifedisp()

adult_age <- 15 

jpn_lt %>% mutate(Country='Japan') %>% 
  filter(Age == adult_age) %>% 
  pivot_longer(cols=c(ex,vx)) %>%
  mutate(name=ifelse(name == 'ex', 'Adult Life Expectancy','Adult Life Disparity'),
         name=factor(name,levels=c('Adult Life Expectancy','Adult Life Disparity'))) %>%
  ggplot() + 
  geom_line(aes(x=Year,y=value, group=Sex,colour=Sex)) +
  facet_wrap(facets=vars(name),ncol=2,scales='free') +
  labs(y='Years')
```