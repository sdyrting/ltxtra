devtools::dev_sitrep()
install.packages(installr)
install.packages('installr')
library(installr)
install.R()
devtools::dev_sitrep()
devtools::update_packages("devtools")
devtools::dev_sitrep()
installr::updateR()
library(installr)
update.R()
installr::updateR()
library(devtools)
devtools::dev_sitrep()
library(devtools)
devtools::dev_sitrep()
devtools::update_packages("devtools")
devtools::dev_sitrep()
usethis::create_package()
usethis::create_package('.')
?usethis::create_package
usethis::create_package('.')
wkdir()
setwd("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity")
usethis::create_package('.')
setwd("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra")
usethis::create_package()
usethis::create_package("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra")
usethis::create_package("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/")
library(devtools)
gitcreds::gitcreds_set()
library(devtools)
load_all
load_all()
load_all()
check()
library(devtools)
load_all()
check()
test()
usethis::create_package("ltxtra")
usethis::create_package("ltxtra2")
cd ..
pwd()
wd()
setwd("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity")
setwd("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch")
library(devtools)
usethis::create_package("ltxtra")
load_all()
library(devtools)
load_all()
test()
check()
check()
load_all()
test()
check()
use_agpl3_license()
use_gpl3_license()
check()
check()
check()
usethis::use_package("expint")
check()
check()
?list
ans <- list(Ro=NA,ao=NA,co=NA,bo=NA,errflag=NA,errmsg=NA)
ans
ans$Ro
ans$Ro <- 1.0
ans$Ro
check()
check()
load_all()
ans <- ogompertz(0.2,5,10)
ans
load_all()
test()
check()
library(devtools)
load_all()
test()
test()
check()
test()
check()
load_all()
check()
load_all()
check()
load_all()
check()
load_all()
check()
olifedisp(0.3,5,10)
load_all()
check()
load_all()
check()
load_all()
check()
load_all()
check()
?lead
library(tidyverse)
?lead
load_all()
load_all()
devtools::document()
devtools::document()
load_all()
rlang::last_trace()
load_all()
devtools::document()
check()
usethis::use_package("dplyr")
check()
load_all()
devtools::document()
check()
load_all()
devtools::document()
check()
load_all()
check()
?mutate
?cumprod
?ifelse
?rev
load_all()
load_all()
check()
?select
load_all()
check()
load_all()
check()
use_package("rlang")
load_all()
check()
?%>%
use_package("magrittr")
load_all()
check()
library(devtools)
load_all()
check()
usethis::use_data_raw()
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
View(states)
length(states)
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
View(aus_2021_2023)
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
View(aus_2021_2023)
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
View(aus_2021_2023)
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
load_all()
dlt <- aus_2021_2023 %>% lifedisp()
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
dlt <- aus_2021_2023 %>% lifedisp()
dlt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
library(expint)
olifedisp <- function(q,n,olifeexp,extrap = 'GOMPERTZ') {
if (extrap == "CONSTANT_FORCE") return(olifeexp)
MAXITS <- 20
RELERR <- 1.0e-6
dx= -n
alpha <- -log(1-q);
beta <- olifeexp
mu <- alpha/abs(dx)
dr <- 1.0/beta
ratio <- -dx/alpha/beta;
if(is.na(ratio)) return(NA)
if (ratio <= 1.0) {#A solution with a > 0 does not exist constant force extrap
ans <- olifeexp
return(ans)
}
astart <- (dr-mu)/mu/abs(dx)
a <- astart
for (j in 1:5) {#Iterate initial guess
xa <- exp(a*dx)
theta <- alpha/(1.0-xa)
e1 <- expint(theta,scale=TRUE)
a <- e1/beta
}
for (i in 1:MAXITS)  {#Newton
xa <- exp(a*dx)
theta <- alpha/(1.0-xa)
dtheta <- theta*(xa/(1.0-xa))*dx
e1 <- expint(theta,scale=TRUE)
de1 <- dtheta*(e1-1.0/theta)
f <- e1/a-beta
df <- (de1*a-e1)/(a*a)
da <- -f/df
a <- a+da
a <- abs(a)
if (abs(da) < RELERR*abs(a)) {
xa <- exp(a*dx)
theta <- alpha/(1.0-xa)
ans <- expint(theta,order=2,scale=TRUE)/a
return(ans)
}
}
errmsg <- "MAXITS exceeded"
stop(errmsg)
}
olifedisp <- Vectorize(olifedisp)
mlt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp_sqa()
lifedisp_sqa <- function(lt) {
BIGAGE <- 200
ans <- lt %>%
mutate(
.nx = lead(Age,default=BIGAGE)-Age,
.lx = lag(cumprod(1-qx),default=1),
.dx = .lx-lead(.lx,default=0),
.Lx = .nx*.lx-(.nx-ax)*.dx,
.Tx = rev(cumsum(rev(.Lx))),
.OV = ifelse(OpenInterval,olifedisp(lag(qx),lag(.nx),ex),0),
.V= ifelse(OpenInterval,.OV*.lx,vfunc(.Lx,.nx,.lx)),
.W= .V+lead(.Tx,default=0)*log(.lx/lead(.lx,default=1)),
vx=rev(cumsum(rev(.W)))/.lx) %>%
select(!c(.nx,.lx,.dx,.Lx,.Tx,.OV,.V,.W))
return(ans)
}
vfunc <- function(YearsLived,AgeInterval,SurvFrac) {
V <- NA
C <- (YearsLived-0.5*AgeInterval*(SurvFrac+lead(SurvFrac,default=0)))/(SurvFrac-lead(SurvFrac,default=0))/AgeInterval
q <- 1- lead(SurvFrac,default=0)/SurvFrac
A <- q*(1-6*C)
B <- 6*q*C
V <- vfunc_qsf(A,B)
V <- AgeInterval*SurvFrac*V
return(V)
}
vfunc_qsf <- function(A,B) {
TINY <- 1.0e-9
if (any(A+B >= 1)) warning('A+B < 1 violated')
if (any(A <= 0)) warning('A > 0 violated')
if (any(A+2*B <= 0)) warning('A+2B > 0 violated')
# C1: B > 0
R1 <- ((sqrt(4*B+A^2)*((4*B+A^2)*log(abs(sqrt(4*B+A^2)+A))+(-(4*B)-A^2)*log(abs(sqrt(4*B+A^2)-A))))/B^2)/12-
((sqrt(4*B+A^2)*((12*B+3*A^2)*log(abs(sqrt(4*B+A^2)+2*B+A))+(-(12*B)-3*A^2)*log(abs(sqrt(4*B+A^2)-2*B-A)))+
(-(12*B^3)+(36-18*A)*B^2+18*A*B+3*A^3)*log(abs(B+A-1))+8*B^3+(12*A-48)*B^2-6*A^2*B)/B^2)/36
# C2: B = 0
R2 <- ((2*log(abs(A-1))-1)*A^2+(2-4*log(abs(A-1)))*A+2*log(abs(A-1)))/(4*A)
# C3.1: B < 0, A^2+4*B > 0
R3.1 <- ((sqrt(4*B+A^2)*((4*B+A^2)*log(abs(sqrt(4*B+A^2)+A))+(-(4*B)-A^2)*log(abs(sqrt(4*B+A^2)-A))))/B^2)/12-
((sqrt(4*B+A^2)*((12*B+3*A^2)*log(abs(sqrt(4*B+A^2)+2*B+A))+(-(12*B)-3*A^2)*log(abs(sqrt(4*B+A^2)-2*B-A)))+
(-(12*B^3)+(36-18*A)*B^2+18*A*B+3*A^3)*log(abs(B+A-1))+8*B^3+(12*A-48)*B^2-6*A^2*B)/B**2)/36
# C3.2: B < 0, A^2+4*B < 0
R3.2 <- (((12*B^3+(18*A-36)*B^2-18*A*B-3*A^3)*log(abs(B+A-1))+
sqrt(-(4*B)-A^2)*(2*(12*B+3*A^2)*atan((sqrt(-(4*B)-A^2)*(2*B+A))/(4*B+A^2)))-
8*B^3+(48-12*A)*B^2+6*A^2*B)/B^2)/36-
((sqrt(-(4*B)-A^2)*(4*B+A^2)*atan((A*sqrt(-(4*B)-A^2))/(4*B+A^2)))/B^2)/6
# C4: |B| < TINY
R4 <- R2
k1 <- B > 0
k2 <- B == 0
k3.1 <- B < 0 & A^2+4*B > 0
k3.2 <- B < 0 & A^2+4*B < 0
k4 <- abs(B) < TINY
ans <- B
ans[k1] <- R1[k1]
ans[k2] <- R2[k2]
ans[k3.1] <- R3.1[k3.1]
ans[k3.2] <- R3.2[k3.2]
ans[k4] <- R4[k4]
return(ans)
}
mlt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp_sqa()
mlt <- aus_2021_2023 %>% filter(State != 'ACT') %>% group_by(State,Sex) %>% lifedisp_sqa()
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
?cumprod
v <- c(1,2,3)
cumprod(v)
lag(v)
lag(v,default=1)
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
source("C:/Users/sdyrting/OneDrive - Charles Darwin University/Sigurd/MyResearch/LifeDisparity/ltxtra/data-raw/aus_2021_2023.R")
mlt <- aus_2021_2023 %>% filter(State != 'ACT') %>% group_by(State,Sex) %>% lifedisp_sqa()
library(devtools)
load_all()
check()
nt_lt <- ltxtra::aus_2021_2023 %>% filter(State == 'NT')
names(ltxtra::aus_2021_2023)
library(tidyverse)
nt_lt <- ltxtra::aus_2021_2023 %>% filter(State == 'NT')
View(nt_lt)
nt_lt <- ltxtra::aus_2021_2023 %>% filter(State == 'NT',Sex=='Female')
nt_dlt <- nt_lt %>% lifedisp()
1/0.37
load_all
load_all()
nt_dlt <- nt_lt %>% lifedisp()
load_all()
nt_dlt <- nt_lt %>% lifedisp()
load_all()
nt_dlt <- nt_lt %>% lifedisp()
warnings()
load_all()
nt_dlt <- nt_lt %>% lifedisp()
1/6
load_all()
nt_dlt <- nt_lt %>% lifedisp()
load_all()
nt_dlt <- nt_lt %>% lifedisp()
load_all()
nt_dlt <- nt_lt %>% lifedisp()
View(nt_dlt)
load_all()
nt_dlt <- nt_lt %>% lifedisp()
View(nt_dlt)
aus_dlt <- ltxtra::aus_2021_2023 %>% group_by(State,Age) %>% lifedisp()
View(aus_dlt)
load_all()
aus_dlt <- ltxtra::aus_2021_2023 %>% group_by(State,Age) %>% lifedisp()
aus_dlt <- ltxtra::aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
library(devtools)
load_all()
check()
check()
check()
library(devtools)
load_all()
check()
library(devtools)
load_all()
check()
pkgbuild::check_build_tools(debug=TRUE)
devtools::check(document=FALSE)
?check
check()
check()
load_all()
my_lt <- aus_2021_2023 %>% lifedisp()
View(my_lt)
my_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
library(tidyverse)
my_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
load_all()
check()
my_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
load_all()
my_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
my_lt <- aus_2021_2023 %>% group_by(State,Sex) %>% lifedisp()
View(my_lt)
my_lt <- aus_2021_2023 %>% filter(State=='ACT',Sex=='Female') %>% group_by(State,Sex) %>% lifedisp()
load_all()
my_lt <- aus_2021_2023 %>% filter(State=='ACT',Sex=='Female') %>% group_by(State,Sex) %>% lifedisp()
load_all()
my_lt <- aus_2021_2023 %>% filter(State=='ACT',Sex=='Female') %>% group_by(State,Sex) %>% lifedisp()
